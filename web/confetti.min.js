let e="PixelPlush Confetti",a={},t={},n="",o=1;function s(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,t.snow&&Unicorn.AddParticles("snowupdown",{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),t.leaves&&(Unicorn.Load("leaf_gold",n+"/assets/game-parachute/autumn_theme/leaf_gold.png"),Unicorn.Load("leaf1",n+"/assets/game-parachute/autumn_theme/leaf1.png"),Unicorn.Load("leaf2",n+"/assets/game-parachute/autumn_theme/leaf2.png"),Unicorn.Load("leaf3",n+"/assets/game-parachute/autumn_theme/leaf3.png"),Unicorn.Load("leaf4",n+"/assets/game-parachute/autumn_theme/leaf4.png"),Unicorn.Load("leaf5",n+"/assets/game-parachute/autumn_theme/leaf5.png"),Unicorn.Load("leaf6",n+"/assets/game-parachute/autumn_theme/leaf6.png"),Unicorn.Load("oak_gold",n+"/assets/game-parachute/autumn_theme/oak_gold.png"),Unicorn.Load("oak1",n+"/assets/game-parachute/autumn_theme/oak1.png"),Unicorn.Load("oak2",n+"/assets/game-parachute/autumn_theme/oak2.png"),Unicorn.Load("oak3",n+"/assets/game-parachute/autumn_theme/oak3.png"),Unicorn.Load("oak4",n+"/assets/game-parachute/autumn_theme/oak4.png"),Unicorn.Load("oak5",n+"/assets/game-parachute/autumn_theme/oak5.png"),Unicorn.Load("oak6",n+"/assets/game-parachute/autumn_theme/oak6.png")),t.snowflakes&&(Unicorn.Load("snowflake1",n+"/assets/game-parachute/christmas_theme/snowflake_1.png"),Unicorn.Load("snowflake2",n+"/assets/game-parachute/christmas_theme/snowflake_2.png"),Unicorn.Load("snowflake3",n+"/assets/game-parachute/christmas_theme/snowflake_3.png"),Unicorn.Load("snowflake4",n+"/assets/game-parachute/christmas_theme/snowflake_4.png"),Unicorn.Load("snowflake5",n+"/assets/game-parachute/christmas_theme/snowflake_5.png"),Unicorn.Load("snowflake6",n+"/assets/game-parachute/christmas_theme/snowflake_6.png"),Unicorn.Load("snowflake7",n+"/assets/game-parachute/christmas_theme/snowflake_7.png")),c=[];for(let e=0;e<l;e++)r.forEach((a=>{let t=`confetti${e+1}_${a}`;c.push(t),Unicorn.Load(t,`${n}/assets/confetti_overlay/confetti${e+1}/${t}.png`)}))}const l=6,r=["blue","darkyellow","green","orange","pastelblue","pastelgreen","pastellime","pastelorange","pastelpink","pastelpurple","pastelred","pastelyellow","pink","purple","red","skyblue","yellow"];let c=[],i=0,h=[],f=[],m=[];function p(e){let a=_(10),t="confetti_"+ ++i,n=Unicorn.AddBacklay(t,e,_(1920),-100,{scale:{x:3,y:3}});n.name=t,n.progress=0,n.offset=a,n.vy=10+_(20),m.push(n)}function u(e,a){const n=a/1e3;for(let e=0;e<h.length;e++){let a=h[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(h[e].name),h.splice(e--,1)):t.leaves2?(h[e].x=2480*Math.sin(a)-100,h[e].y+=Math.sin(20*a+h[e].offset),h[e].angle=10*Math.cos(20*a)+60*h[e].offset):(h[e].x=2480*Math.sin(a)-100,h[e].y+=n/10*1080+h[e].offset/10+Math.sin(20*a+h[e].offset),h[e].angle=10*Math.cos(20*a)+60*h[e].offset)}for(let e=0;e<f.length;e++){let a=f[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(f[e].name),f.splice(e--,1)):(f[e].y+=n/10*1180+f[e].offset/10+Math.sin(20*a+f[e].offset),f[e].angle=10*Math.cos(20*a)+60*f[e].offset)}for(let e=0;e<m.length;e++)m[e].y>=1180?(Unicorn.RemoveBacklay(m[e].name),m.splice(e--,1)):(m[e].x+=1*Math.sin((600*m[e].offset+m[e].y)/1e3),m[e].vy+=1.5*(n/10*1180+m[e].offset/10),m[e].y+=m[e].vy*n,m[e].angle+=(20+m[e].offset)/10)}async function d(e,a,t,n,o){if(!n.broadcaster&&!n.mod||"resetconfetti"!==a&&"resetparticles"!==a||location.reload(),(n.broadcaster||n.mod)&&("deleteconfetti"===a||"deleteparticles"===a)){let e=await ComfyJS.GetChannelRewards(w,!0),a=Object.keys(y);for(let t=0;t<a.length;t++){let n=a[t],o=e.find((e=>e.title===n));o&&await ComfyJS.DeleteChannelReward(w,o.id)}}if((n.mod||n.broadcaster||n.vip)&&"confetti"===a){const e=parseInt(t||"1000"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{p(c[_(c.length)])}),10*(t+a)+_(100))}}function g(e,a,t,n,o){}function _(e){return Math.floor(e*Math.random())}var k="";let w="";const y={};async function U(){return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:k,game:"confetti",theme:e,channel:t.channel,players:[t.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(l,r,i){e=l,a=r,t=i,n=a.path||"",o=i.nth||1,function(){try{t.cpConfetti&&(y["Confetti Explosion!"]={desc:"Sprinkle PixelPlush Confetti into the stream!",color:"#F2C079",cost:parseInt(t.cpConfettiCost||50),callback:(e,a,t,n,o)=>{const s=1e3,l=3;for(let e=0;e<l;e++)for(let e=0;e<s/l;e++)setTimeout((()=>{p(c[_(c.length)])}),10*(e+l)+_(100))}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:s,update:u,channel:t.channel,username:t.oauth?t.channel:void 0,password:t.oauth,onCommand:d,onChat:g,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await U();if(0!==e&&(k=e.session,setInterval((()=>{U()}),6e4)),t.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then((e=>e.json())).catch((e=>({error:e})))}(t.oauth.replace("oauth:",""));console.log(e),w=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let a=[];try{a=await ComfyJS.GetChannelRewards(w,!0)}catch(e){console.log(e)}let n=Object.keys(y);console.log(y);for(let e=0;e<n.length;e++){let t=n[e];a.some((e=>e.title===t))||await ComfyJS.CreateChannelReward(w,{title:t,prompt:y[t].desc,cost:y[t].cost,is_enabled:!0,background_color:y[t].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!y[t].cooldown,global_cooldown_seconds:y[t].cooldown,should_redemptions_skip_request_queue:!0})}}ComfyJS.onReward=(e,a,t,n,o)=>{y[a]&&y[a].callback(e,a,t,n,o)}}}()};