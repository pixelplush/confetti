let e="PixelPlush Confetti",t={},o={},n="",a=.5;function s(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;const e=o.colors?o.colors.split(","):c;i=[];for(let t=0;t<l;t++)e.forEach((e=>{let o=`confetti${t+1}_${e}`;i.push(o),Unicorn.Load(o,`${n}/assets/confetti_overlay/confetti/confetti${t+1}/confetti${t+1}_${e}.png`)}));f=[];for(let t=0;t<r;t++)e.forEach((e=>{let o=`bubble${t+1}_${e}`;f.push(o),Unicorn.Load(o,`${n}/assets/confetti_overlay/bubbles/bubble${t+1}/bubble${t+1}_${e}.png`)}));h=[],e.forEach((e=>{let t=`balloon_${e}`;h.push(t),Unicorn.Load(t,`${n}/assets/confetti_overlay/balloons/balloon_${e}.png`)})),p=[],e.forEach((e=>{for(let t=0;t<4;t++)Unicorn.Load(`heart_${e}${t+1}`,`${n}/assets/confetti_overlay/hearts/heart${t+2}/heart${t+2}_${e}.png`),p.push(`heart_${e}${t+1}`)})),d=[],e.forEach((e=>{let t=`firefly_${e}`;d.push(t),Unicorn.Load(`firefly_${e}`,`${n}/assets/pets/firefly_orange/firefly_orange_front/firefly_orange_front1.png`);const o="firefly_orange",a=`${o}_front`;for(let t=0;t<10;t++)Unicorn.Load(`firefly_${e}_${t}`,`${n}/assets/pets/${o}/${a}/${a}${t+1}.png`)})),Unicorn.Load("sfx_bubble0",`${n}/assets/sfx/bubbles1.mp3`),Unicorn.Load("sfx_bubble1",`${n}/assets/sfx/bubbles2.mp3`),Unicorn.Load("sfx_bubble2",`${n}/assets/sfx/bubbles3.mp3`)}const l=6,r=2,c=["yellow","skyblue","red","purple","pinkpurple","pink","pastelyellow","pastelred","pastelpurple","pastelpink","pastelorange","pastellime","pastelgreen","pastelblue","orange","lime","green","darkyellow","blue","deepred","deepblue","copper","gold","rosegold","silver","brightred","brown","hotpink"];let i=[],f=[],h=[],p=[],d=[],u=0,m=[],b=[],y=[],_=[],g=[];function v(e){let t=U(10),o="confetti_"+ ++u,n=Unicorn.AddBacklay(o,e,U(1920),-100,{scale:{x:3,y:3}});n.name=o,n.progress=0,n.offset=t,n.vy=10+U(20),m.push(n)}function k(e){let t=U(10),o="confetti_"+ ++u,n=Unicorn.AddBacklay(o,e,U(1920),1180,{scale:{x:3,y:3}});n.name=o,n.progress=0,n.offset=t,n.vy=10+U(20),n.alpha=Math.random(),b.push(n)}function w(e){let t=U(10),o="confetti_"+ ++u,n=2+1*Math.random(),a=Unicorn.AddBacklay(o,e,U(1920),1180,{scale:{x:n,y:n}});a.name=o,a.progress=0,a.offset=t,a.vy=500+U(50),a.alpha=.8,y.push(a)}function x(e){const t=U(1920);for(let o=0;o<1;o++){let o="floaty_"+ ++u;const n=U(10),a=U(100),s=Math.random()*Math.PI;let l=Unicorn.AddBacklay(o,e,t-5+n,1080+a,{scale:{x:3,y:3}});l.timeOffset=s,l.label=o,l.zIndex=11,l.refX=t,l.refY=1080,l.lifetime=10,l.anchor.set(.5),_.push(l)}}function $(e){const t=U(1920),o=U(1080);for(let e=0;e<1;e++){let e="floaty_"+ ++u;const n=U(10),a=U(100),s=Math.random()*Math.PI;let l=Unicorn.AddObject(e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:16/60,frames:Array.from({length:10},((e,t)=>`firefly_orange_${t}`)),loop:!0}},x:t-5+n,y:o-5+a,radius:24,isStatic:!0});l.timeOffset=s,l.label=e,l.zIndex=11,l.movementAngle=Math.random()*Math.PI*2,l.speed=50,l.blinkSpeed=.15*Math.random()+.15,l.animations.front.alpha=0,l.refX=t,l.refY=o,l.lifetime=10,g.push(l)}}function I(e,t){const o=t/1e3;for(let e=0;e<m.length;e++)m[e].y>=1180?(Unicorn.RemoveBacklay(m[e].name),m.splice(e--,1)):(m[e].x+=1*Math.sin((600*m[e].offset+m[e].y)/1e3),m[e].vy+=1.5*(o/10*1180+m[e].offset/10),m[e].y+=m[e].vy*o,m[e].angle+=(20+m[e].offset)/10);for(let e=0;e<b.length;e++)b[e].y<-100?(Unicorn.RemoveBacklay(b[e].name),b.splice(e--,1)):(b[e].vy+=1.5*(o/10*1180+b[e].offset/10),b[e].y-=b[e].vy*o);for(let t=0;t<y.length;t++)y[t].y<-200?(Unicorn.RemoveBacklay(y[t].name),y.splice(t--,1)):(y[t].y-=y[t].vy*o,y[t].angle=2*Math.sin((20+y[t].offset*e/100)/10));for(let e=0;e<_.length;e++){let o=_[e];o.lifetime>0&&(o.lifetime-=t/1e3,o.y-=180*t/1e3,o.x=o.refX+20*Math.sin(4*o.lifetime+o.timeOffset),o.lifetime<0&&(Unicorn.RemoveBacklay(o.label),_.splice(e,1),e--))}for(let e=0;e<g.length;e++){let o=g[e];if(o.lifetime>0){o.lifetime-=t/1e3,o.movementAngle+=.2*(Math.random()-.5),o.position.x+=Math.cos(o.movementAngle)*o.speed*t/1e3,o.position.y+=Math.sin(o.movementAngle)*o.speed*t/1e3;const n=.5*Math.sin(10*(10-o.lifetime)*o.blinkSpeed)+.5,a=10,s=.2*a,l=10-o.lifetime;o.animations.front.alpha=l<s?n*(l/s):a-l<s?n*((a-l)/s):n,o.lifetime<0&&(Unicorn.RemoveObject(o.label),g.splice(e,1),e--)}}}async function C(e,t,o,n,s){if(!n.broadcaster&&!n.mod||"resetconfetti"!==t&&"resetparticles"!==t||location.reload(),(n.broadcaster||n.mod)&&("deleteconfetti"===t||"deleteparticles"===t)){let e=await ComfyJS.GetChannelRewards(T,!0),t=Object.keys(L);for(let o=0;o<t.length;o++){let n=t[o],a=e.find((e=>e.title===n));a&&await ComfyJS.DeleteChannelReward(T,a.id)}}if(n.mod||n.broadcaster||n.vip){if("confetti"===t){const e=parseInt(o||"300"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{v(i[U(i.length)])}),10*(o+t)+U(100))}if("bubbles"===t){const e=parseInt(o||"300"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{k(f[U(f.length)])}),10*(o+t)+U(100));Unicorn.PlaySound("sfx_bubble"+U(3),{volume:a})}if("balloons"===t){const e=parseInt(o||"20"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{w(h[U(h.length)])}),80*(o+t)+U(300))}if("hearts"===t){const e=parseInt(o||"20"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{x(p[U(p.length)])}),80*(o+t)+U(300))}if("fireflies"===t&&("instafluff"===s.channel||"maaya"===s.channel)){const e=parseInt(o||"20"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{$(d[U(d.length)])}),80*(o+t)+U(300))}}}function S(e,t,o,n,a){}function U(e){return Math.floor(e*Math.random())}async function M(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then((e=>e.json())).catch((e=>({error:e})))}async function B(e){return await fetch(`https://api.pixelplush.dev/v1/auth/refresh?token=${e}`).then((e=>e.json())).catch((e=>({error:e})))}var A="";let T="";const L={};async function E(){return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:A,game:"confetti",theme:e,channel:o.channel,players:[o.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(l,r,c){e=l,t=r,o=c,n=t.path||"",a=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,async function(){try{const e=(await fetch(`${n}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));if(o.channel&&e&&e.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),o.oauth&&(o.oauth=await async function(e,t){const o=localStorage.getItem("pixelplush_token"),n=localStorage.getItem("pixelplush_refresh");if(o){const e=await M(o);if(console.log("stored access token",e),e&&e.user_id&&e.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((t=>e.scopes.includes(t))))return o}if(n){const e=await B(n);if(console.log("stored refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((t=>e.scope.includes(t))))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}const a=await M(e);if(console.log("provided access token",a),a&&a.user_id&&a.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((e=>a.scopes.includes(e))))return localStorage.setItem("pixelplush_token",e),localStorage.setItem("pixelplush_refresh",t),e;if(t){const e=await B(t);if(console.log("provided refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((t=>e.scope.includes(t))))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}return console.log("no valid tokens"),null}(o.oauth.replace("oauth:",""),o.refreshToken)),t.requires)try{if(account=await fetch("https://stats.pixelplush.dev/v1/accounts",{headers:{Twitch:o.oauth?o.oauth.replace("oauth:",""):void 0}}).then((e=>e.json())),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(t.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}o.cpConfetti&&(L["Confetti Explosion!"]={desc:"Sprinkle confetti into the stream!",color:"#F2C079",cost:parseInt(o.cpConfettiCost||50),callback:(e,t,n,a,s)=>{const l=parseInt(o.cpConfettiIntensity||"300"),r=3;for(let e=0;e<r;e++)for(let e=0;e<l/r;e++)setTimeout((()=>{v(i[U(i.length)])}),10*(e+r)+U(100))}}),o.cpBubbles&&(L["Bubbles!"]={desc:"Blow some bubbles into the stream!",color:"#F2C079",cost:parseInt(o.cpBubblesCost||50),callback:(e,t,n,s,l)=>{const r=parseInt(o.cpBubblesIntensity||"300"),c=3;for(let e=0;e<c;e++)for(let e=0;e<r/c;e++)setTimeout((()=>{k(f[U(f.length)])}),10*(e+c)+U(100));Unicorn.PlaySound("sfx_bubble"+U(3),{volume:a})}}),o.cpBalloons&&(L["Balloons!"]={desc:"Release balloons into the stream!",color:"#F2C079",cost:parseInt(o.cpBalloonsCost||50),callback:(e,t,n,a,s)=>{const l=parseInt(o.cpBalloonsIntensity||"20"),r=3;for(let e=0;e<r;e++)for(let e=0;e<l/r;e++)setTimeout((()=>{w(h[U(h.length)])}),80*(e+r)+U(300))}}),o.cpHearts&&(L["Hearts!"]={desc:"Float hearts into the stream!",color:"#F2C079",cost:parseInt(o.cpHeartsCost||50),callback:(e,t,n,a,s)=>{const l=parseInt(o.cpHeartsIntensity||"20"),r=3;for(let e=0;e<r;e++)for(let e=0;e<l/r;e++)setTimeout((()=>{x(p[U(p.length)])}),80*(e+r)+U(300))}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:s,update:I,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth?o.oauth.replace("oauth:",""):void 0,onCommand:C,onChat:S,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,t,n)=>{if(n){let e=await E();if(0!==e&&(A=e.session,setInterval((()=>{E()}),6e4)),o.oauth){let e=await M(o.oauth.replace("oauth:",""));T=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((t=>e.scopes.includes(t)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=[];try{t=await ComfyJS.GetChannelRewards(T,!0)}catch(e){console.log(e)}let n=Object.keys(L);for(let e=0;e<n.length;e++){let o=n[e];t.some((e=>e.title===o))||await ComfyJS.CreateChannelReward(T,{title:o,prompt:L[o].desc,cost:L[o].cost,is_enabled:!0,background_color:L[o].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!L[o].cooldown,global_cooldown_seconds:L[o].cooldown,should_redemptions_skip_request_queue:!0})}}ComfyJS.onReward=(e,t,o,n,a)=>{L[t]&&L[t].callback(e,t,o,n,a)}}}()};