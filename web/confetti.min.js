let e="PixelPlush Confetti",t={},o={},n="",a=.5;function l(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;const e=o.colors?o.colors.split(","):c;i=[];for(let t=0;t<s;t++)e.forEach((e=>{let o=`confetti${t+1}_${e}`;i.push(o),Unicorn.Load(o,`${n}/assets/confetti_overlay/confetti/confetti${t+1}/confetti${t+1}_${e}.png`)}));f=[];for(let t=0;t<r;t++)e.forEach((e=>{let o=`bubble${t+1}_${e}`;f.push(o),Unicorn.Load(o,`${n}/assets/confetti_overlay/bubbles/bubble${t+1}/bubble${t+1}_${e}.png`)}))}const s=6,r=2,c=["yellow","skyblue","red","purple","pinkpurple","pink","pastelyellow","pastelred","pastelpurple","pastelpink","pastelorange","pastellime","pastelgreen","pastelblue","orange","lime","green","darkyellow","blue"];let i=[],f=[],h=0,p=[],u=[];function d(e){let t=g(10),o="confetti_"+ ++h,n=Unicorn.AddBacklay(o,e,g(1920),-100,{scale:{x:3,y:3}});n.name=o,n.progress=0,n.offset=t,n.vy=10+g(20),p.push(n)}function m(e){let t=g(10),o="confetti_"+ ++h,n=Unicorn.AddBacklay(o,e,g(1920),1180,{scale:{x:3,y:3}});n.name=o,n.progress=0,n.offset=t,n.vy=10+g(20),u.push(n)}function b(e,t){const o=t/1e3;for(let e=0;e<p.length;e++)p[e].y>=1180?(Unicorn.RemoveBacklay(p[e].name),p.splice(e--,1)):(p[e].x+=1*Math.sin((600*p[e].offset+p[e].y)/1e3),p[e].vy+=1.5*(o/10*1180+p[e].offset/10),p[e].y+=p[e].vy*o,p[e].angle+=(20+p[e].offset)/10);for(let e=0;e<u.length;e++)u[e].y<-100?(Unicorn.RemoveBacklay(u[e].name),u.splice(e--,1)):(u[e].vy+=1.5*(o/10*1180+u[e].offset/10),u[e].y-=u[e].vy*o)}async function y(e,t,o,n,a){if(!n.broadcaster&&!n.mod||"resetconfetti"!==t&&"resetparticles"!==t||location.reload(),(n.broadcaster||n.mod)&&("deleteconfetti"===t||"deleteparticles"===t)){let e=await ComfyJS.GetChannelRewards(v,!0),t=Object.keys(C);for(let o=0;o<t.length;o++){let n=t[o],a=e.find((e=>e.title===n));a&&await ComfyJS.DeleteChannelReward(v,a.id)}}if(n.mod||n.broadcaster||n.vip){if("confetti"===t){const e=parseInt(o||"100"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{d(i[g(i.length)])}),10*(o+t)+g(100))}if("bubbles"===t){const e=parseInt(o||"100"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{m(f[g(f.length)])}),10*(o+t)+g(100))}}}function _(e,t,o,n,a){}function g(e){return Math.floor(e*Math.random())}var w="";let v="";const C={};async function k(){return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:w,game:"confetti",theme:e,channel:o.channel,players:[o.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(s,r,c){e=s,t=r,o=c,n=t.path||"",a=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,async function(){try{const e=(await fetch(n+"/assets/shamelist.txt").then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));o.channel&&e&&e.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),o.cpConfetti&&(C["Confetti Explosion!"]={desc:"Sprinkle confetti into the stream!",color:"#F2C079",cost:parseInt(o.cpConfettiCost||50),callback:(e,t,o,n,a)=>{const l=1e3,s=3;for(let e=0;e<s;e++)for(let e=0;e<l/s;e++)setTimeout((()=>{d(i[g(i.length)])}),10*(e+s)+g(100))}}),o.cpBubbles&&(C["Bubbles!"]={desc:"Blow some bubbles into the stream!",color:"#F2C079",cost:parseInt(o.cpBubblesCost||50),callback:(e,t,o,n,a)=>{const l=1e3,s=3;for(let e=0;e<s;e++)for(let e=0;e<l/s;e++)setTimeout((()=>{m(f[g(f.length)])}),10*(e+s)+g(100))}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:l,update:b,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth?o.oauth.replace("oauth:",""):void 0,onCommand:y,onChat:_,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,t,n)=>{if(n){let e=await k();if(0!==e&&(w=e.session,setInterval((()=>{k()}),6e4)),o.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then((e=>e.json())).catch((e=>({error:e})))}(o.oauth.replace("oauth:",""));v=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((t=>e.scopes.includes(t)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=[];try{t=await ComfyJS.GetChannelRewards(v,!0)}catch(e){console.log(e)}let n=Object.keys(C);for(let e=0;e<n.length;e++){let o=n[e];t.some((e=>e.title===o))||await ComfyJS.CreateChannelReward(v,{title:o,prompt:C[o].desc,cost:C[o].cost,is_enabled:!0,background_color:C[o].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!C[o].cooldown,global_cooldown_seconds:C[o].cooldown,should_redemptions_skip_request_queue:!0})}}ComfyJS.onReward=(e,t,o,n,a)=>{C[t]&&C[t].callback(e,t,o,n,a)}}}()};