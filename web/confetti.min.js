const e="https://api.pixelplush.dev/v1";let t="PixelPlush Confetti",o={},n={},a="",l=.5;function s(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;const e=n.colors?n.colors.split(","):i;u=[];for(let t=0;t<r;t++)e.forEach((e=>{let o=`confetti${t+1}_${e}`;u.push(o),Unicorn.Load(o,`${a}/assets/confetti_overlay/confetti/confetti${t+1}/confetti${t+1}_${e}.png`)}));f=[];for(let t=0;t<c;t++)e.forEach((e=>{let o=`bubble${t+1}_${e}`;f.push(o),Unicorn.Load(o,`${a}/assets/confetti_overlay/bubbles/bubble${t+1}/bubble${t+1}_${e}.png`)}));h=[],e.forEach((e=>{let t="balloon_"+e;h.push(t),Unicorn.Load(t,`${a}/assets/confetti_overlay/balloons/balloon_${e}.png`)})),Unicorn.Load("sfx_bubble0",a+"/assets/sfx/bubbles1.mp3"),Unicorn.Load("sfx_bubble1",a+"/assets/sfx/bubbles2.mp3"),Unicorn.Load("sfx_bubble2",a+"/assets/sfx/bubbles3.mp3")}const r=6,c=2,i=["yellow","skyblue","red","purple","pinkpurple","pink","pastelyellow","pastelred","pastelpurple","pastelpink","pastelorange","pastellime","pastelgreen","pastelblue","orange","lime","green","darkyellow","blue","deepred","deepblue","copper","gold","rosegold","silver"];let u=[],f=[],h=[],d=0,p=[],b=[],m=[];function y(e){let t=x(10),o="confetti_"+ ++d,n=Unicorn.AddBacklay(o,e,x(1920),-100,{scale:{x:3,y:3}});n.name=o,n.progress=0,n.offset=t,n.vy=10+x(20),p.push(n)}function _(e){let t=x(10),o="confetti_"+ ++d,n=Unicorn.AddBacklay(o,e,x(1920),1180,{scale:{x:3,y:3}});n.name=o,n.progress=0,n.offset=t,n.vy=10+x(20),n.alpha=Math.random(),b.push(n)}function g(e){let t=x(10),o="confetti_"+ ++d,n=2+1*Math.random(),a=Unicorn.AddBacklay(o,e,x(1920),1180,{scale:{x:n,y:n}});a.name=o,a.progress=0,a.offset=t,a.vy=500+x(50),a.alpha=.8,m.push(a)}function v(e,t){const o=t/1e3;for(let e=0;e<p.length;e++)p[e].y>=1180?(Unicorn.RemoveBacklay(p[e].name),p.splice(e--,1)):(p[e].x+=1*Math.sin((600*p[e].offset+p[e].y)/1e3),p[e].vy+=1.5*(o/10*1180+p[e].offset/10),p[e].y+=p[e].vy*o,p[e].angle+=(20+p[e].offset)/10);for(let e=0;e<b.length;e++)b[e].y<-100?(Unicorn.RemoveBacklay(b[e].name),b.splice(e--,1)):(b[e].vy+=1.5*(o/10*1180+b[e].offset/10),b[e].y-=b[e].vy*o);for(let t=0;t<m.length;t++)m[t].y<-200?(Unicorn.RemoveBacklay(m[t].name),m.splice(t--,1)):(m[t].y-=m[t].vy*o,m[t].angle=2*Math.sin((20+m[t].offset*e/100)/10))}async function w(e,t,o,n,a){if(!n.broadcaster&&!n.mod||"resetconfetti"!==t&&"resetparticles"!==t||location.reload(),(n.broadcaster||n.mod)&&("deleteconfetti"===t||"deleteparticles"===t)){let e=await ComfyJS.GetChannelRewards(S,!0),t=Object.keys(U);for(let o=0;o<t.length;o++){let n=t[o],a=e.find((e=>e.title===n));a&&await ComfyJS.DeleteChannelReward(S,a.id)}}if(n.mod||n.broadcaster||n.vip){if("confetti"===t){const e=parseInt(o||"300"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{y(u[x(u.length)])}),10*(o+t)+x(100))}if("bubbles"===t){const e=parseInt(o||"300"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{_(f[x(f.length)])}),10*(o+t)+x(100));Unicorn.PlaySound("sfx_bubble"+x(3),{volume:l})}if("balloons"===t){const e=parseInt(o||"20"),t=4;for(let o=0;o<t;o++)for(let o=0;o<e/t;o++)setTimeout((()=>{g(h[x(h.length)])}),80*(o+t)+x(300))}}}function C(e,t,o,n,a){}function x(e){return Math.floor(e*Math.random())}var k="";let S="";const U={};async function $(){return fetch(e+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:k,game:"confetti",theme:t,channel:n.channel,players:[n.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(r,c,i){t=r,o=c,n=i,a=o.path||"",l=void 0===n.volume||null===n.volume?0:parseInt(n.volume)/100,async function(){try{const t=(await fetch(a+"/assets/shamelist.txt").then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));if(n.channel&&t&&t.includes(n.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),o.requires)try{if(account=await fetch(e+"/accounts",{headers:{Twitch:n.oauth?n.oauth.replace("oauth:",""):void 0}}).then((e=>e.json())),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(o.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}n.cpConfetti&&(U["Confetti Explosion!"]={desc:"Sprinkle confetti into the stream!",color:"#F2C079",cost:parseInt(n.cpConfettiCost||50),callback:(e,t,o,n,a)=>{const l=300,s=3;for(let e=0;e<s;e++)for(let e=0;e<l/s;e++)setTimeout((()=>{y(u[x(u.length)])}),10*(e+s)+x(100))}}),n.cpBubbles&&(U["Bubbles!"]={desc:"Blow some bubbles into the stream!",color:"#F2C079",cost:parseInt(n.cpBubblesCost||50),callback:(e,t,o,n,a)=>{const s=300,r=3;for(let e=0;e<r;e++)for(let e=0;e<s/r;e++)setTimeout((()=>{_(f[x(f.length)])}),10*(e+r)+x(100));Unicorn.PlaySound("sfx_bubble"+x(3),{volume:l})}}),n.cpBalloons&&(U["Balloons!"]={desc:"Release balloons into the stream!",color:"#F2C079",cost:parseInt(n.cpBalloonsCost||50),callback:(e,t,o,n,a)=>{const l=20,s=3;for(let e=0;e<s;e++)for(let e=0;e<l/s;e++)setTimeout((()=>{g(h[x(h.length)])}),80*(e+s)+x(300))}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:s,update:v,channel:n.channel,username:n.oauth?n.channel:void 0,password:n.oauth?n.oauth.replace("oauth:",""):void 0,onCommand:w,onChat:C,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,t,o)=>{if(o){let e=await $();if(0!==e&&(k=e.session,setInterval((()=>{$()}),6e4)),n.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then((e=>e.json())).catch((e=>({error:e})))}(n.oauth.replace("oauth:",""));S=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((t=>e.scopes.includes(t)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=[];try{t=await ComfyJS.GetChannelRewards(S,!0)}catch(e){console.log(e)}let o=Object.keys(U);for(let e=0;e<o.length;e++){let n=o[e];t.some((e=>e.title===n))||await ComfyJS.CreateChannelReward(S,{title:n,prompt:U[n].desc,cost:U[n].cost,is_enabled:!0,background_color:U[n].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!U[n].cooldown,global_cooldown_seconds:U[n].cooldown,should_redemptions_skip_request_queue:!0})}}ComfyJS.onReward=(e,t,o,n,a)=>{U[t]&&U[t].callback(e,t,o,n,a)}}}()};