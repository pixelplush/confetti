let e="PixelPlush Confetti",a={},t={},n="",o=1;function s(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,t.snow&&Unicorn.AddParticles("snowupdown",{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),t.leaves&&(Unicorn.Load("leaf_gold",n+"/assets/game-parachute/autumn_theme/leaf_gold.png"),Unicorn.Load("leaf1",n+"/assets/game-parachute/autumn_theme/leaf1.png"),Unicorn.Load("leaf2",n+"/assets/game-parachute/autumn_theme/leaf2.png"),Unicorn.Load("leaf3",n+"/assets/game-parachute/autumn_theme/leaf3.png"),Unicorn.Load("leaf4",n+"/assets/game-parachute/autumn_theme/leaf4.png"),Unicorn.Load("leaf5",n+"/assets/game-parachute/autumn_theme/leaf5.png"),Unicorn.Load("leaf6",n+"/assets/game-parachute/autumn_theme/leaf6.png"),Unicorn.Load("oak_gold",n+"/assets/game-parachute/autumn_theme/oak_gold.png"),Unicorn.Load("oak1",n+"/assets/game-parachute/autumn_theme/oak1.png"),Unicorn.Load("oak2",n+"/assets/game-parachute/autumn_theme/oak2.png"),Unicorn.Load("oak3",n+"/assets/game-parachute/autumn_theme/oak3.png"),Unicorn.Load("oak4",n+"/assets/game-parachute/autumn_theme/oak4.png"),Unicorn.Load("oak5",n+"/assets/game-parachute/autumn_theme/oak5.png"),Unicorn.Load("oak6",n+"/assets/game-parachute/autumn_theme/oak6.png")),t.snowflakes&&(Unicorn.Load("snowflake1",n+"/assets/game-parachute/christmas_theme/snowflake_1.png"),Unicorn.Load("snowflake2",n+"/assets/game-parachute/christmas_theme/snowflake_2.png"),Unicorn.Load("snowflake3",n+"/assets/game-parachute/christmas_theme/snowflake_3.png"),Unicorn.Load("snowflake4",n+"/assets/game-parachute/christmas_theme/snowflake_4.png"),Unicorn.Load("snowflake5",n+"/assets/game-parachute/christmas_theme/snowflake_5.png"),Unicorn.Load("snowflake6",n+"/assets/game-parachute/christmas_theme/snowflake_6.png"),Unicorn.Load("snowflake7",n+"/assets/game-parachute/christmas_theme/snowflake_7.png")),i=[];for(let e=0;e<l;e++)r.forEach((a=>{let t=`confetti${e+1}_${a}`;i.push(t),Unicorn.Load(t,`${n}/assets/confetti_overlay/confetti${e+1}/${t}.png`)}));h=[],c.forEach((e=>{let a="bubble_"+e;h.push(a),Unicorn.Load(a,`${n}/assets/confetti_overlay/bubbles/bubbles_${e}.png`),a=`bubble_${e}_small`,h.push(a),Unicorn.Load(a,`${n}/assets/confetti_overlay/bubbles/bubbles_small_${e}.png`)}))}const l=6,r=["blue","darkyellow","green","orange","pastelblue","pastelgreen","pastellime","pastelorange","pastelpink","pastelpurple","pastelred","pastelyellow","pink","purple","red","skyblue","yellow"],c=["yellow","red","purple","pink","orange","green","blue_light","blue_dark"];let i=[],h=[],f=0,p=[],u=[],m=[],d=[];function g(e){let a=w(10),t="confetti_"+ ++f,n=Unicorn.AddBacklay(t,e,w(1920),-100,{scale:{x:3,y:3}});n.name=t,n.progress=0,n.offset=a,n.vy=10+w(20),m.push(n)}function _(e){let a=w(10),t="confetti_"+ ++f,n=Unicorn.AddBacklay(t,e,w(1920),1180,{scale:{x:3,y:3}});n.name=t,n.progress=0,n.offset=a,n.vy=10+w(20),d.push(n)}function b(e,a){const n=a/1e3;for(let e=0;e<p.length;e++){let a=p[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(p[e].name),p.splice(e--,1)):t.leaves2?(p[e].x=2480*Math.sin(a)-100,p[e].y+=Math.sin(20*a+p[e].offset),p[e].angle=10*Math.cos(20*a)+60*p[e].offset):(p[e].x=2480*Math.sin(a)-100,p[e].y+=n/10*1080+p[e].offset/10+Math.sin(20*a+p[e].offset),p[e].angle=10*Math.cos(20*a)+60*p[e].offset)}for(let e=0;e<u.length;e++){let a=u[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(u[e].name),u.splice(e--,1)):(u[e].y+=n/10*1180+u[e].offset/10+Math.sin(20*a+u[e].offset),u[e].angle=10*Math.cos(20*a)+60*u[e].offset)}for(let e=0;e<m.length;e++)m[e].y>=1180?(Unicorn.RemoveBacklay(m[e].name),m.splice(e--,1)):(m[e].x+=1*Math.sin((600*m[e].offset+m[e].y)/1e3),m[e].vy+=1.5*(n/10*1180+m[e].offset/10),m[e].y+=m[e].vy*n,m[e].angle+=(20+m[e].offset)/10);for(let e=0;e<d.length;e++)d[e].y<-100?(Unicorn.RemoveBacklay(d[e].name),d.splice(e--,1)):(d[e].vy+=1.5*(n/10*1180+d[e].offset/10),d[e].y-=d[e].vy*n)}async function y(e,a,t,n,o){if(!n.broadcaster&&!n.mod||"resetconfetti"!==a&&"resetparticles"!==a||location.reload(),(n.broadcaster||n.mod)&&("deleteconfetti"===a||"deleteparticles"===a)){let e=await ComfyJS.GetChannelRewards(L,!0),a=Object.keys(C);for(let t=0;t<a.length;t++){let n=a[t],o=e.find((e=>e.title===n));o&&await ComfyJS.DeleteChannelReward(L,o.id)}}if(n.mod||n.broadcaster||n.vip){if("confetti"===a){const e=parseInt(t||"100"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{g(i[w(i.length)])}),10*(t+a)+w(100))}if("bubbles"===a){const e=parseInt(t||"100"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{_(h[w(c.length)])}),10*(t+a)+w(100))}}}function k(e,a,t,n,o){}function w(e){return Math.floor(e*Math.random())}var U="";let L="";const C={};async function v(){return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:U,game:"confetti",theme:e,channel:t.channel,players:[t.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(l,r,c){e=l,a=r,t=c,n=a.path||"",o=c.nth||1,async function(){try{const e=(await fetch(n+"/assets/shamelist.txt").then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));t.channel&&e&&e.includes(t.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),t.cpConfetti&&(C["Confetti Explosion!"]={desc:"Sprinkle confetti into the stream!",color:"#F2C079",cost:parseInt(t.cpConfettiCost||50),callback:(e,a,t,n,o)=>{const s=1e3,l=3;for(let e=0;e<l;e++)for(let e=0;e<s/l;e++)setTimeout((()=>{g(i[w(i.length)])}),10*(e+l)+w(100))}}),t.cpBubbles&&(C["Bubbles!"]={desc:"Blow some bubbles into the stream!",color:"#F2C079",cost:parseInt(t.cpBubblesCost||50),callback:(e,a,t,n,o)=>{const s=1e3,l=3;for(let e=0;e<l;e++)for(let e=0;e<s/l;e++)setTimeout((()=>{_(h[w(h.length)])}),10*(e+l)+w(100))}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:s,update:b,channel:t.channel,username:t.oauth?t.channel:void 0,password:t.oauth?t.oauth.replace("oauth:",""):void 0,onCommand:y,onChat:k,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await v();if(0!==e&&(U=e.session,setInterval((()=>{v()}),6e4)),t.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then((e=>e.json())).catch((e=>({error:e})))}(t.oauth.replace("oauth:",""));L=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let a=[];try{a=await ComfyJS.GetChannelRewards(L,!0)}catch(e){console.log(e)}let n=Object.keys(C);for(let e=0;e<n.length;e++){let t=n[e];a.some((e=>e.title===t))||await ComfyJS.CreateChannelReward(L,{title:t,prompt:C[t].desc,cost:C[t].cost,is_enabled:!0,background_color:C[t].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!C[t].cooldown,global_cooldown_seconds:C[t].cooldown,should_redemptions_skip_request_queue:!0})}}ComfyJS.onReward=(e,a,t,n,o)=>{C[a]&&C[a].callback(e,a,t,n,o)}}}()};